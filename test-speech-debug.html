<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speech Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            line-height: 1.6;
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .button:hover {
            background: #0056b3;
        }
        .button.danger {
            background: #dc3545;
        }
        .button.danger:hover {
            background: #c82333;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.idle {
            background: #d4edda;
            color: #155724;
        }
        .status.speaking {
            background: #fff3cd;
            color: #856404;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>üé§ Speech Debug Test</h1>
    <p>This page tests the speechSynthesis fixes directly in the browser.</p>

    <div class="status idle" id="status">Status: Idle</div>

    <div>
        <button class="button" onclick="checkSpeechSynthesis()">Check speechSynthesis</button>
        <button class="button" onclick="testBasicSpeech()">Test Basic Speech</button>
        <button class="button" onclick="testLongSpeech()">Test Long Speech</button>
        <button class="button danger" onclick="stopSpeech()">Stop Speech</button>
        <button class="button danger" onclick="resetAll()">Reset All</button>
    </div>

    <div>
        <input type="text" id="customText" placeholder="Enter custom text to speak" style="width: 300px; padding: 8px; margin: 10px;">
        <button class="button" onclick="speakCustom()">Speak Custom</button>
    </div>

    <div class="log" id="log"></div>

    <script>
        let isSpeaking = false;
        let currentUtterance = null;

        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function updateStatus(status, className = 'idle') {
            const statusElement = document.getElementById('status');
            statusElement.textContent = `Status: ${status}`;
            statusElement.className = `status ${className}`;
        }

        function checkSpeechSynthesis() {
            log('üîç Checking speechSynthesis availability...');
            
            if ('speechSynthesis' in window) {
                log('‚úÖ window.speechSynthesis is available');
                log(`üîç speechSynthesis object: ${typeof window.speechSynthesis}`);
                log(`üîç speechSynthesis.speak: ${typeof window.speechSynthesis.speak}`);
                log(`üîç speechSynthesis.cancel: ${typeof window.speechSynthesis.cancel}`);
                log(`üîç speechSynthesis.getVoices: ${typeof window.speechSynthesis.getVoices}`);
                
                const voices = window.speechSynthesis.getVoices();
                log(`üé≠ Available voices: ${voices.length}`);
                
                if (voices.length > 0) {
                    voices.slice(0, 3).forEach((voice, index) => {
                        log(`  ${index + 1}. ${voice.name} (${voice.lang})`);
                    });
                } else {
                    log('‚ö†Ô∏è No voices loaded yet, they may load asynchronously');
                }
            } else {
                log('‚ùå window.speechSynthesis is NOT available');
            }
        }

        function testBasicSpeech() {
            if (!window.speechSynthesis) {
                log('‚ùå speechSynthesis not available');
                updateStatus('Error: speechSynthesis not available', 'error');
                return;
            }

            if (isSpeaking) {
                log('‚ö†Ô∏è Already speaking, stopping current speech first');
                stopSpeech();
            }

            log('üó£Ô∏è Testing basic speech...');
            updateStatus('Speaking', 'speaking');
            isSpeaking = true;

            const utterance = new SpeechSynthesisUtterance('Hello! This is a basic speech test.');
            utterance.rate = 0.9;
            utterance.pitch = 1.0;
            utterance.volume = 0.8;

            utterance.onstart = () => {
                log('‚úÖ Speech started');
            };

            utterance.onend = () => {
                log('‚úÖ Speech completed');
                updateStatus('Idle', 'idle');
                isSpeaking = false;
                currentUtterance = null;
            };

            utterance.onerror = (event) => {
                log(`‚ùå Speech error: ${event.error}`);
                updateStatus(`Error: ${event.error}`, 'error');
                isSpeaking = false;
                currentUtterance = null;
            };

            currentUtterance = utterance;
            
            try {
                window.speechSynthesis.speak(utterance);
                log('üöÄ speechSynthesis.speak() called');
            } catch (error) {
                log(`‚ùå Exception calling speak(): ${error.message}`);
                updateStatus(`Error: ${error.message}`, 'error');
                isSpeaking = false;
            }
        }

        function testLongSpeech() {
            if (!window.speechSynthesis) {
                log('‚ùå speechSynthesis not available');
                return;
            }

            if (isSpeaking) {
                log('‚ö†Ô∏è Already speaking, stopping current speech first');
                stopSpeech();
            }

            const longText = "Hello! This is LISA testing a longer speech response. I am your Language Intelligence Support Assistant, and I can help you with glass manufacturing orders, customer inquiries, and much more. This test will help us verify that the speech synthesis system is working correctly in Chrome and other browsers.";
            
            log('üó£Ô∏è Testing long speech...');
            updateStatus('Speaking (Long)', 'speaking');
            isSpeaking = true;

            const utterance = new SpeechSynthesisUtterance(longText);
            utterance.rate = 0.9;
            utterance.pitch = 1.0;
            utterance.volume = 0.8;

            utterance.onstart = () => {
                log('‚úÖ Long speech started');
            };

            utterance.onend = () => {
                log('‚úÖ Long speech completed');
                updateStatus('Idle', 'idle');
                isSpeaking = false;
                currentUtterance = null;
            };

            utterance.onerror = (event) => {
                log(`‚ùå Long speech error: ${event.error}`);
                updateStatus(`Error: ${event.error}`, 'error');
                isSpeaking = false;
                currentUtterance = null;
            };

            currentUtterance = utterance;
            window.speechSynthesis.speak(utterance);
        }

        function speakCustom() {
            const customText = document.getElementById('customText').value.trim();
            if (!customText) {
                log('‚ö†Ô∏è Please enter some text to speak');
                return;
            }

            if (!window.speechSynthesis) {
                log('‚ùå speechSynthesis not available');
                return;
            }

            if (isSpeaking) {
                log('‚ö†Ô∏è Already speaking, stopping current speech first');
                stopSpeech();
            }

            log(`üó£Ô∏è Speaking custom text: "${customText}"`);
            updateStatus('Speaking (Custom)', 'speaking');
            isSpeaking = true;

            const utterance = new SpeechSynthesisUtterance(customText);
            utterance.rate = 0.9;
            utterance.pitch = 1.0;
            utterance.volume = 0.8;

            utterance.onstart = () => {
                log('‚úÖ Custom speech started');
            };

            utterance.onend = () => {
                log('‚úÖ Custom speech completed');
                updateStatus('Idle', 'idle');
                isSpeaking = false;
                currentUtterance = null;
            };

            utterance.onerror = (event) => {
                log(`‚ùå Custom speech error: ${event.error}`);
                updateStatus(`Error: ${event.error}`, 'error');
                isSpeaking = false;
                currentUtterance = null;
            };

            currentUtterance = utterance;
            window.speechSynthesis.speak(utterance);
        }

        function stopSpeech() {
            log('üõë Stopping speech...');
            
            if (window.speechSynthesis && typeof window.speechSynthesis.cancel === 'function') {
                try {
                    window.speechSynthesis.cancel();
                    log('‚úÖ speechSynthesis.cancel() called');
                } catch (error) {
                    log(`‚ùå Error calling cancel(): ${error.message}`);
                }
            } else {
                log('‚ö†Ô∏è speechSynthesis.cancel not available');
            }
            
            isSpeaking = false;
            currentUtterance = null;
            updateStatus('Idle (Stopped)', 'idle');
        }

        function resetAll() {
            log('üîÑ Resetting all speech state...');
            stopSpeech();
            
            // Clear log
            setTimeout(() => {
                document.getElementById('log').innerHTML = '';
                log('üîÑ Reset complete - ready for testing');
            }, 500);
        }

        // Auto-check on page load
        window.addEventListener('load', () => {
            log('üöÄ Page loaded, checking speechSynthesis...');
            checkSpeechSynthesis();
            
            // Check for voices loading asynchronously
            if (window.speechSynthesis) {
                window.speechSynthesis.addEventListener('voiceschanged', () => {
                    log('üîÑ Voices changed event fired');
                    const voices = window.speechSynthesis.getVoices();
                    log(`üé≠ Voices now available: ${voices.length}`);
                });
            }
        });
    </script>
</body>
</html>
