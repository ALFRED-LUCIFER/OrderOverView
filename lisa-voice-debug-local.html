<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LISA Voice Debug - Browser Environment Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; } .error { color: red; } .warning { color: orange; }
        .log { margin: 5px 0; padding: 5px; background: #f5f5f5; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>🎤 LISA Voice Debug - Browser Environment Test</h1>
    
    <div class="test-section">
        <h3>📦 Module Loading Test</h3>
        <div id="module-test"></div>
    </div>
    
    <div class="test-section">
        <h3>🔌 WebSocket Connection Test</h3>
        <div id="websocket-test"></div>
    </div>
    
    <div class="test-section">
        <h3>🎵 Audio API Test</h3>
        <div id="audio-test"></div>
    </div>
    
    <div class="test-section">
        <h3>🎯 Environment Variables Test</h3>
        <div id="env-test"></div>
    </div>
    
    <script src="https://cdn.socket.io/4.7.0/socket.io.min.js"></script>
    <script>
        function log(section, message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `${new Date().toLocaleTimeString()} - ${message}`;
            document.getElementById(section).appendChild(div);
            console.log(`[${section}] ${message}`);
        }

        // Test 1: Module Loading
        log('module-test', 'Testing Socket.IO loading...', 'info');
        if (typeof io !== 'undefined') {
            log('module-test', '✅ Socket.IO loaded successfully', 'success');
        } else {
            log('module-test', '❌ Socket.IO not loaded', 'error');
        }

        // Test 2: WebSocket Connection
        log('websocket-test', 'Testing WebSocket connection to ws://localhost:3001...', 'info');
        
        try {
            const socket = io('ws://localhost:3001', {
                timeout: 5000,
                transports: ['websocket', 'polling']
            });
            
            socket.on('connect', () => {
                log('websocket-test', `✅ Connected! Socket ID: ${socket.id}`, 'success');
                log('websocket-test', `Transport: ${socket.io.engine.transport.name}`, 'info');
            });
            
            socket.on('connected', (data) => {
                log('websocket-test', `🎉 LISA backend connected: ${data.agent}`, 'success');
                log('websocket-test', `Session: ${data.sessionId}`, 'info');
                log('websocket-test', `Message: ${data.message}`, 'info');
            });
            
            socket.on('connect_error', (error) => {
                log('websocket-test', `❌ Connection failed: ${error.message}`, 'error');
                log('websocket-test', `Error type: ${error.type}`, 'error');
            });
            
            setTimeout(() => {
                socket.disconnect();
            }, 10000);
            
        } catch (error) {
            log('websocket-test', `❌ WebSocket test failed: ${error.message}`, 'error');
        }

        // Test 3: Audio API
        log('audio-test', 'Testing Web Audio API...', 'info');
        
        if ('speechSynthesis' in window) {
            log('audio-test', '✅ Speech Synthesis available', 'success');
            
            const voices = speechSynthesis.getVoices();
            log('audio-test', `Available voices: ${voices.length}`, 'info');
            
            if (voices.length === 0) {
                speechSynthesis.addEventListener('voiceschanged', () => {
                    const newVoices = speechSynthesis.getVoices();
                    log('audio-test', `Voices loaded: ${newVoices.length}`, 'info');
                });
            }
        } else {
            log('audio-test', '❌ Speech Synthesis not available', 'error');
        }
        
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            log('audio-test', '✅ Speech Recognition available', 'success');
        } else {
            log('audio-test', '❌ Speech Recognition not available', 'error');
        }

        // Test 4: Environment Variables (simulated)
        log('env-test', 'Testing environment configuration...', 'info');
        
        // In a real React app, these would be from import.meta.env
        const mockEnv = {
            VITE_ENABLE_VOICE: 'true',
            VITE_API_URL: 'http://localhost:3001',
            VITE_WEBSOCKET_URL: 'ws://localhost:3001'
        };
        
        Object.entries(mockEnv).forEach(([key, value]) => {
            log('env-test', `${key}: ${value}`, 'info');
        });
        
        if (mockEnv.VITE_ENABLE_VOICE === 'true') {
            log('env-test', '✅ Voice feature enabled', 'success');
        } else {
            log('env-test', '❌ Voice feature disabled', 'warning');
        }

        // Test 5: API Connection
        setTimeout(() => {
            log('websocket-test', 'Testing API endpoint...', 'info');
            fetch('http://localhost:3001/api/customers')
                .then(response => {
                    if (response.ok) {
                        log('websocket-test', '✅ API endpoint accessible', 'success');
                        return response.json();
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                })
                .then(data => {
                    log('websocket-test', `API returned ${data.length} customers`, 'info');
                })
                .catch(error => {
                    log('websocket-test', `❌ API test failed: ${error.message}`, 'error');
                });
        }, 2000);
    </script>
</body>
</html>
