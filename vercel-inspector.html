<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vercel Site Inspector - Live Testing</title>
    <style>
        body { 
            font-family: 'Monaco', 'Menlo', monospace; 
            margin: 0; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #00ff00;
            line-height: 1.4;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { 
            background: #2a2a2a; 
            margin: 20px 0; 
            padding: 20px; 
            border-radius: 8px; 
            border: 1px solid #444;
        }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
            font-weight: bold;
        }
        .success { background: #0a4a0a; color: #00ff00; }
        .error { background: #4a0a0a; color: #ff5555; }
        .warning { background: #4a4a0a; color: #ffff55; }
        .info { background: #0a0a4a; color: #5555ff; }
        
        button { 
            padding: 12px 20px; 
            margin: 8px; 
            background: #00aa00; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-family: inherit;
        }
        button:hover { background: #00cc00; }
        button:disabled { background: #666; cursor: not-allowed; }
        
        #output { 
            background: #000; 
            padding: 15px; 
            border-radius: 5px; 
            height: 400px; 
            overflow-y: auto; 
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        .controls { display: flex; flex-wrap: wrap; gap: 10px; margin: 20px 0; }
        .iframe-container { 
            border: 2px solid #444; 
            border-radius: 8px; 
            height: 600px; 
            margin: 20px 0;
        }
        iframe { width: 100%; height: 100%; border: none; border-radius: 6px; }
        
        h1 { color: #00ff00; text-align: center; margin-bottom: 30px; }
        h2 { color: #ffff55; border-bottom: 1px solid #444; padding-bottom: 10px; }
        h3 { color: #5555ff; margin-top: 25px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Live Vercel Site Inspector</h1>
        
        <div class="section">
            <h2>ğŸ¯ Current Target</h2>
            <div class="status info">
                <strong>Frontend:</strong> https://order-over-view-frontend.vercel.app<br>
                <strong>Backend:</strong> https://orderoverview-dkro.onrender.com<br>
                <strong>WebSocket:</strong> wss://orderoverview-dkro.onrender.com
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ§ª Automated Tests</h2>
            <div class="controls">
                <button onclick="testWebSocketConnection()">ğŸ”Œ Test WebSocket</button>
                <button onclick="testAPIConnection()">ğŸŒ Test API</button>
                <button onclick="testLISAVoice()">ğŸ¤ Test LISA</button>
                <button onclick="inspectEnvironment()">âš™ï¸ Check Environment</button>
                <button onclick="monitorConsole()">ğŸ“Š Monitor Console</button>
                <button onclick="clearOutput()">ğŸ—‘ï¸ Clear</button>
            </div>
            
            <div id="testStatus" class="status info">Ready to run tests...</div>
            
            <h3>ğŸ“‹ Test Output:</h3>
            <div id="output"></div>
        </div>
        
        <div class="section">
            <h2>ğŸ–¥ï¸ Live Site Preview</h2>
            <div class="iframe-container">
                <iframe src="https://order-over-view-frontend.vercel.app" 
                        title="Live Vercel Site"></iframe>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ” Manual Inspection Checklist</h2>
            <div class="status warning">
                <strong>Things to check in the iframe above:</strong><br>
                âœ“ Does the page load without errors?<br>
                âœ“ Can you see the dashboard with data?<br>
                âœ“ Is there a voice interface visible?<br>
                âœ“ Are there any console errors? (F12 â†’ Console)<br>
                âœ“ Do API calls work? (Network tab)<br>
                âœ“ Does LISA voice interface respond?
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.0/socket.io.min.js"></script>
    <script>
        const output = document.getElementById('output');
        const status = document.getElementById('testStatus');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                error: '#ff5555',
                success: '#00ff00', 
                warning: '#ffff55',
                info: '#5555ff'
            };
            
            output.innerHTML += `<span style="color: ${colors[type] || '#00ff00'}">[${timestamp}] ${message}</span>\n`;
            output.scrollTop = output.scrollHeight;
        }
        
        function updateStatus(message, type = 'info') {
            status.className = `status ${type}`;
            status.innerHTML = message;
        }
        
        function clearOutput() {
            output.innerHTML = '';
            log('Output cleared', 'info');
        }
        
        async function testWebSocketConnection() {
            log('ğŸ”Œ Testing WebSocket connection...', 'info');
            updateStatus('Testing WebSocket...', 'info');
            
            return new Promise((resolve) => {
                const socket = io('wss://orderoverview-dkro.onrender.com', {
                    timeout: 10000,
                    transports: ['websocket', 'polling']
                });
                
                let connected = false;
                
                socket.on('connect', () => {
                    connected = true;
                    log(`âœ… WebSocket connected successfully!`, 'success');
                    log(`   Socket ID: ${socket.id}`, 'success');
                    log(`   Transport: ${socket.io.engine.transport.name}`, 'success');
                    updateStatus('WebSocket: Connected!', 'success');
                });
                
                socket.on('connected', (data) => {
                    log(`ğŸ‰ LISA backend connected:`, 'success');
                    log(`   Session: ${data.sessionId}`, 'success');
                    log(`   Agent: ${data.agent}`, 'success');
                    log(`   Message: ${data.message}`, 'success');
                });
                
                socket.on('connect_error', (error) => {
                    log(`âŒ WebSocket error: ${error.message}`, 'error');
                    updateStatus('WebSocket: Failed!', 'error');
                });
                
                setTimeout(() => {
                    if (connected) {
                        log('ğŸ”Œ Disconnecting test connection', 'info');
                        socket.disconnect();
                        resolve(true);
                    } else {
                        log('âŒ WebSocket connection timeout', 'error');
                        updateStatus('WebSocket: Timeout!', 'error');
                        resolve(false);
                    }
                }, 10000);
            });
        }
        
        async function testAPIConnection() {
            log('ğŸŒ Testing API endpoints...', 'info');
            updateStatus('Testing API...', 'info');
            
            const endpoints = [
                { url: 'https://orderoverview-dkro.onrender.com/api/docs', name: 'API Docs' },
                { url: 'https://orderoverview-dkro.onrender.com/api/customers', name: 'Customers API' },
                { url: 'https://orderoverview-dkro.onrender.com/api/orders', name: 'Orders API' }
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint.url);
                    if (response.ok) {
                        log(`âœ… ${endpoint.name}: ${response.status} OK`, 'success');
                    } else {
                        log(`âŒ ${endpoint.name}: ${response.status} ${response.statusText}`, 'error');
                    }
                } catch (error) {
                    log(`âŒ ${endpoint.name}: ${error.message}`, 'error');
                }
            }
            
            updateStatus('API tests completed', 'success');
        }
        
        async function testLISAVoice() {
            log('ğŸ¤ Testing LISA voice interface...', 'info');
            updateStatus('Testing LISA...', 'info');
            
            const socket = io('wss://orderoverview-dkro.onrender.com');
            
            socket.on('connect', () => {
                log('âœ… Connected to LISA backend', 'success');
                
                // Send a test voice command
                socket.emit('voice-command', {
                    transcript: 'Hello LISA, are you working?',
                    isEndOfSpeech: true,
                    interimResults: false,
                    useNaturalConversation: true
                });
                
                log('ğŸ’¬ Sent test command: "Hello LISA, are you working?"', 'info');
            });
            
            socket.on('voice-response', (data) => {
                log('ğŸ—¨ï¸ LISA responded:', 'success');
                log(`   "${data.response}"`, 'success');
                if (data.action) log(`   Action: ${data.action}`, 'info');
                updateStatus('LISA: Responding!', 'success');
                
                setTimeout(() => {
                    socket.disconnect();
                    log('ğŸ”Œ Test completed', 'info');
                }, 2000);
            });
            
            socket.on('connect_error', (error) => {
                log(`âŒ LISA connection error: ${error.message}`, 'error');
                updateStatus('LISA: Failed!', 'error');
            });
        }
        
        function inspectEnvironment() {
            log('âš™ï¸ Inspecting environment configuration...', 'info');
            updateStatus('Checking environment...', 'info');
            
            // Check if we can access the Vercel site's environment
            const iframe = document.querySelector('iframe');
            
            log('ğŸ” Environment check:', 'info');
            log(`   Current page: ${window.location.href}`, 'info');
            log(`   User agent: ${navigator.userAgent}`, 'info');
            log(`   WebSocket support: ${typeof WebSocket !== 'undefined' ? 'âœ…' : 'âŒ'}`, 'info');
            log(`   Socket.IO loaded: ${typeof io !== 'undefined' ? 'âœ…' : 'âŒ'}`, 'info');
            
            // Test if we can reach the Vercel site
            fetch('https://order-over-view-frontend.vercel.app')
                .then(response => {
                    log(`âœ… Vercel site reachable: ${response.status}`, 'success');
                    updateStatus('Environment: OK', 'success');
                })
                .catch(error => {
                    log(`âŒ Vercel site error: ${error.message}`, 'error');
                    updateStatus('Environment: Issues detected', 'error');
                });
        }
        
        function monitorConsole() {
            log('ğŸ“Š Starting console monitoring...', 'info');
            updateStatus('Monitoring console...', 'info');
            
            // Override console methods to capture logs
            const originalLog = console.log;
            const originalError = console.error;
            const originalWarn = console.warn;
            
            console.log = function(...args) {
                log(`[CONSOLE LOG] ${args.join(' ')}`, 'info');
                originalLog.apply(console, args);
            };
            
            console.error = function(...args) {
                log(`[CONSOLE ERROR] ${args.join(' ')}`, 'error');
                originalError.apply(console, args);
            };
            
            console.warn = function(...args) {
                log(`[CONSOLE WARN] ${args.join(' ')}`, 'warning');
                originalWarn.apply(console, args);
            };
            
            log('âœ… Console monitoring active', 'success');
            log('â„¹ï¸ Open browser DevTools to see live console output', 'info');
        }
        
        // Auto-start basic tests
        window.addEventListener('load', () => {
            log('ğŸš€ Vercel Site Inspector loaded', 'success');
            log('â„¹ï¸ Click buttons above to run tests', 'info');
            log('â„¹ï¸ Check the iframe below for visual inspection', 'info');
        });
    </script>
</body>
</html>
