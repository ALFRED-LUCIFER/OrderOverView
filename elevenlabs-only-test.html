<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ElevenLabs Only Test - LISA Voice</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .status {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #4CAF50;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .danger {
            background: linear-gradient(45deg, #f44336, #d32f2f) !important;
        }
        
        .info {
            background: linear-gradient(45deg, #2196F3, #1976D2) !important;
        }
        
        .debug-info {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        
        .log-success { background: rgba(76, 175, 80, 0.2); }
        .log-error { background: rgba(244, 67, 54, 0.2); }
        .log-warning { background: rgba(255, 152, 0, 0.2); }
        .log-info { background: rgba(33, 150, 243, 0.2); }
        
        .voice-test-input {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé§ ElevenLabs Only Test</h1>
        <div id="status" class="status">
            <strong>Mode:</strong> ElevenLabs ONLY (Browser TTS disabled)
        </div>
        
        <!-- API Status Section -->
        <div class="test-section">
            <h3>üì° API Status</h3>
            <button onclick="checkApiKey()" class="info">Check API Key</button>
            <button onclick="testConnection()" class="info">Test Connection</button>
            <button onclick="checkQuota()">Check Quota</button>
            <div id="api-status"></div>
        </div>
        
        <!-- Voice Testing Section -->
        <div class="test-section">
            <h3>üó£Ô∏è Voice Testing</h3>
            <input type="text" id="customText" class="voice-test-input" 
                   placeholder="Enter custom text to speak..." 
                   value="Hello! This is LISA speaking using ElevenLabs voice synthesis. The browser TTS has been completely disabled for this test.">
            
            <div>
                <button onclick="testSimpleTTS()">Test Simple TTS</button>
                <button onclick="testCustomText()">Speak Custom Text</button>
                <button onclick="testLongText()">Test Long Text</button>
                <button onclick="stopSpeech()" class="danger">Stop Speech</button>
            </div>
        </div>
        
        <!-- LISA Conversation Test -->
        <div class="test-section">
            <h3>üí¨ LISA Conversation Test</h3>
            <button onclick="testLisaGreeting()">LISA Greeting</button>
            <button onclick="testLisaOrderResponse()">LISA Order Response</button>
            <button onclick="testLisaError()">LISA Error Response</button>
        </div>
        
        <!-- Debug Section -->
        <div class="test-section">
            <h3>üîç Debug Info</h3>
            <button onclick="showDebugInfo()">Show Service Status</button>
            <button onclick="clearLog()">Clear Log</button>
        </div>
        
        <div id="debug-info" class="debug-info"></div>
        <div id="log" class="debug-info"></div>
    </div>

    <script>
        // ElevenLabs service testing
        const API_KEY = 'sk_1e3890ea4390a3dc3cb9ae9d32588befd0d02a65b61cb499';
        const BASE_URL = 'https://api.elevenlabs.io/v1';
        const LISA_VOICE_ID = 'EXAVITQu4vr4xnSDxMaL'; // Bella voice
        
        let currentAudio = null;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        async function checkApiKey() {
            log('üîë Checking API key configuration...', 'info');
            
            if (!API_KEY || API_KEY === 'your-api-key-here') {
                log('‚ùå API key not configured', 'error');
                return false;
            }
            
            if (API_KEY.length < 10) {
                log('‚ö†Ô∏è API key appears to be too short', 'warning');
                return false;
            }
            
            log(`‚úÖ API key configured (${API_KEY.substring(0, 8)}...)`, 'success');
            return true;
        }

        async function testConnection() {
            log('üì° Testing ElevenLabs API connection...', 'info');
            
            try {
                const response = await fetch(`${BASE_URL}/voices`, {
                    headers: {
                        'xi-api-key': API_KEY,
                    },
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                log(`‚úÖ Connection successful! Found ${data.voices?.length || 0} voices`, 'success');
                
                // Check if our LISA voice is available
                const lisaVoice = data.voices?.find(v => v.voice_id === LISA_VOICE_ID);
                if (lisaVoice) {
                    log(`üé≠ LISA voice found: ${lisaVoice.name}`, 'success');
                } else {
                    log('‚ö†Ô∏è LISA voice not found in available voices', 'warning');
                }
                
                document.getElementById('api-status').innerHTML = 
                    `<div style="color: #4CAF50;">‚úÖ Connected - ${data.voices?.length || 0} voices available</div>`;
                return true;
            } catch (error) {
                log(`‚ùå Connection failed: ${error.message}`, 'error');
                document.getElementById('api-status').innerHTML = 
                    `<div style="color: #f44336;">‚ùå Connection failed: ${error.message}</div>`;
                return false;
            }
        }

        async function checkQuota() {
            log('üìä Checking API quota...', 'info');
            
            try {
                const response = await fetch(`${BASE_URL}/user/subscription`, {
                    headers: {
                        'xi-api-key': API_KEY,
                    },
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                log(`üìä Quota: ${data.character_count}/${data.character_limit} characters used`, 'info');
                document.getElementById('api-status').innerHTML = 
                    `<div>üìä Quota: ${data.character_count}/${data.character_limit} characters (${data.status})</div>`;
            } catch (error) {
                log(`‚ùå Quota check failed: ${error.message}`, 'error');
            }
        }

        async function synthesizeSpeech(text) {
            log(`üé§ Synthesizing speech: "${text.substring(0, 50)}${text.length > 50 ? '...' : ''}"`, 'info');
            
            try {
                const response = await fetch(`${BASE_URL}/text-to-speech/${LISA_VOICE_ID}`, {
                    method: 'POST',
                    headers: {
                        'Accept': 'audio/mpeg',
                        'Content-Type': 'application/json',
                        'xi-api-key': API_KEY,
                    },
                    body: JSON.stringify({
                        text: text,
                        model_id: 'eleven_monolingual_v1',
                        voice_settings: {
                            stability: 0.75,
                            similarity_boost: 0.75,
                            style: 0.0,
                            use_speaker_boost: true,
                        },
                    }),
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                const audioBlob = await response.blob();
                log(`‚úÖ Speech synthesized successfully (${audioBlob.size} bytes)`, 'success');
                return audioBlob;
            } catch (error) {
                log(`‚ùå Speech synthesis failed: ${error.message}`, 'error');
                throw error;
            }
        }

        async function playAudio(audioBlob) {
            return new Promise((resolve, reject) => {
                // Stop any current audio
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio = null;
                }

                const audioUrl = URL.createObjectURL(audioBlob);
                const audio = new Audio(audioUrl);
                currentAudio = audio;

                audio.onended = () => {
                    URL.revokeObjectURL(audioUrl);
                    currentAudio = null;
                    log('‚úÖ Audio playback completed', 'success');
                    resolve();
                };

                audio.onerror = (error) => {
                    URL.revokeObjectURL(audioUrl);
                    currentAudio = null;
                    log(`‚ùå Audio playback error: ${error}`, 'error');
                    reject(new Error('Audio playback failed'));
                };

                audio.oncanplaythrough = () => {
                    log('üîä Starting audio playback...', 'info');
                    audio.play().catch(reject);
                };

                audio.load();
            });
        }

        async function speak(text) {
            try {
                const audioBlob = await synthesizeSpeech(text);
                await playAudio(audioBlob);
            } catch (error) {
                log(`‚ùå Speak failed: ${error.message}`, 'error');
            }
        }

        function stopSpeech() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
                log('üõë Speech stopped', 'info');
            }
        }

        // Test functions
        async function testSimpleTTS() {
            await speak("Hello! This is a simple ElevenLabs text-to-speech test.");
        }

        async function testCustomText() {
            const text = document.getElementById('customText').value;
            if (text.trim()) {
                await speak(text);
            }
        }

        async function testLongText() {
            const longText = "This is a longer text-to-speech test using ElevenLabs. I'm testing the quality and reliability of the voice synthesis service. The voice should sound natural and clear, with proper pronunciation and intonation. This test helps verify that the ElevenLabs integration is working correctly in our LISA voice assistant system.";
            await speak(longText);
        }

        async function testLisaGreeting() {
            await speak("Hello! I'm LISA, your voice-powered glass order management assistant. I'm now speaking exclusively through ElevenLabs voice synthesis. How can I help you with your glass orders today?");
        }

        async function testLisaOrderResponse() {
            await speak("I found 3 orders matching your search criteria. The first order is number 1001 for Skyline Glass Corporation, with a total value of 15,230 dollars. It's currently in production with high priority status. Would you like me to provide more details about this order?");
        }

        async function testLisaError() {
            await speak("I apologize, but I encountered an error while processing your request. Please try again, or ask me to search for orders in a different way. I'm here to help with all your glass order management needs.");
        }

        function showDebugInfo() {
            const debugInfo = {
                mode: 'ELEVENLABS_ONLY_TESTING',
                apiKey: API_KEY ? `${API_KEY.substring(0, 8)}...` : 'Not configured',
                voiceId: LISA_VOICE_ID,
                baseUrl: BASE_URL,
                currentAudio: currentAudio ? 'Playing' : 'None',
                browserTTS: 'DISABLED',
                timestamp: new Date().toISOString()
            };

            document.getElementById('debug-info').textContent = JSON.stringify(debugInfo, null, 2);
            log('üìã Debug info displayed', 'info');
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            log('üßπ Log cleared', 'info');
        }

        // Initialize
        window.addEventListener('load', () => {
            log('üöÄ ElevenLabs Only Test initialized', 'success');
            log('‚ÑπÔ∏è Browser TTS is completely disabled for this test', 'info');
            checkApiKey();
        });
    </script>
</body>
</html>
